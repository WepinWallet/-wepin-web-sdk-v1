(function(c,d){typeof exports=="object"&&typeof module<"u"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(c=typeof globalThis<"u"?globalThis:c||self,d(c["@wepin/modal-js"]={}))})(this,function(c){"use strict";const m=class m{static closeOverlay(e){const t=document.querySelector(`#${e}`);t&&t.parentNode&&t.parentNode.removeChild(t)}static openOverlay(e){const t=document.createElement("div");t.id=e,t.classList.add(this.CONST.overlayClassName),t.style.zIndex="2147483647",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.textAlign="center",t.style.position="fixed",t.style.left="0px",t.style.right="0px",t.style.top="0px",t.style.bottom="0px",t.style.left="0px",t.style.background="rgba(0,0,0,0.6)",t.style.color="white",t.style.border="2px solid #f1f1f1";const o=document.getElementsByClassName(this.CONST.overlayClassName);for(let l=0;l<o.length;l++){const i=o.item(l);i&&i.remove()}document.body.appendChild(t)}};m.CONST={overlayClassName:"wepin-widget__overlay"};let d=m;const w=s=>{const e=(s==null?void 0:s.width)||375,t=(s==null?void 0:s.height)||604,o=s!=null&&s.sLeft?s==null?void 0:s.sLeft:window.screenLeft?window.screenLeft:window.screenX?window.screenX:0,l=s!=null&&s.sTop?s==null?void 0:s.sTop:window.screenTop?window.screenTop:window.screenY?window.screenY:0,i=screen.width/2-e/2+o,h=screen.height/2-t/2+l;return`width=${e}, height=${t}, left=${i}, top=${h}scrollbars=yes, resizable=1, menubar=no, toolbar=no`},v=s=>{const e=document.createElement("iframe");return e.classList.add("wepin-sdk-widget-iframe"),e.setAttribute("frameborder","0"),e.setAttribute("marginwidth","0"),e.setAttribute("marginheight","0"),e.style.width="100%",s&&(s!=null&&s.isHide)?e.style.height="0":e.style.height="100%",e.style.maxHeight="100%",e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.zIndex="408888000000",e.title="wepin sdk webview",e.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; camera; clipboard-read",e.allowFullscreen=!0,e},x=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)}),r=class r extends d{constructor(e,t,o,l,i){super(),this.isWidgetReady=!1,this.url=e,this.id=`id-${x()}`,this.isHide=i,i||r.openOverlay(this.id),r._webview[this.id]=t,this.type=o,this.EL=l,window.addEventListener("message",this.EL),this._open=!0}get isOpen(){return this._open}static getWebview(e){return r._webview[e]}static clearWebview(e){delete r._webview[e]}static clearAllWebview(){this._webview={}}close(){this.isHide||r.closeOverlay(this.id),window.removeEventListener("message",this.EL),this._open=!1,this.isWidgetReady=!1,this._closeWebview()}response(e){try{this._post(e)}catch(t){console.error("Can not response message to the webview",t)}}request(e){try{this._post(e)}catch(t){console.error("Can not send message to the webview",t)}}};r._webview={};let n=r;class a extends n{constructor({url:e,frame:t,EL:o,isHide:l}){super(e,t,"Frame",o,l),t.src=e,t.id=this.id;const i=document.querySelector("body");a.scrollPosition=window.pageYOffset,i.style.overflow="hidden",i.style.position="fixed",i.style.top=`-${a.scrollPosition}px`,i.style.width="100%",document.body.appendChild(t)}static async openNew({url:e,EL:t,widgetOptions:o}){const l=v({isHide:o==null?void 0:o.isHide});return new a({url:e,frame:l,EL:t,isHide:o==null?void 0:o.isHide})}expand(){const e=n.getWebview(this.id);e.style.height="100%",e.style.borderRadius="0"}shrink(){const e=n.getWebview(this.id);e.style.height="604px",e.style.borderRadius="12px 12px 0 0 "}_closeWebview(){const e=setTimeout(()=>{const t=n.getWebview(this.id),o=document.querySelector("body");o.style.removeProperty("overflow"),o.style.removeProperty("position"),o.style.removeProperty("top"),o.style.removeProperty("width"),window.scrollTo(0,a.scrollPosition),t&&document.body.removeChild(t),n.clearWebview(this.id),clearTimeout(e)},500)}_post(e){n.getWebview(this.id).contentWindow.postMessage(e,this.url)}}class p extends n{constructor({url:e,webview:t,EL:o}){super(e,t,"Window",o,!1)}static async openNew({url:e,EL:t,widgetFeatures:o}){const l=w(o),h=window.open(e,"Wepin_Widget",l),y=new p({url:e,webview:h,EL:t});if(!h)throw y.close(),new Error("popup window blocked");return this.timer=setInterval(()=>{try{h&&h.closed&&(clearInterval(this.timer),y.close())}catch{clearInterval(this.timer),y.close()}},200),y}expand(){}shrink(){}_closeWebview(){p.timer&&(clearInterval(p.timer),p.timer=void 0);const e=n.getWebview(this.id);e&&e.close(),n.clearWebview(this.id)}_post(e){n.getWebview(this.id).postMessage(e,this.url)}}const b={name:"@wepin/modal-js",version:"0.0.1",description:"wepin widget modal",author:"IoTrust, Co., Ltd.",license:"MIT",main:"./dist/wepin-modal-js.mjs",jsdelivr:"dist/wepin-modal-js.umd.js",types:"./dist/src/index.d.ts",files:["dist"],scripts:{build:"vite build --mode production",dev:"vite build --mode development",watch:"vite build --watch",lint:"eslint . --ext .vue,.js,.jsx,.cjs,.mjs,.ts,.tsx,.cts,.mts --fix --ignore-path .gitignore"},keywords:["wepin","wepinwallet","wallet","wepin-modal"]};class f{constructor(){this.platformType="web",this._modalWindow=null,this._modalFrame=null,console.log(`WepinModal v${b.version}`),this.domain=window.location.origin}async openAuthBrowser(e,t){return this._modalWindow=await p.openNew({url:e,EL:t}),this._modalWindow}async openModal(e,t,o){return this._modalFrame=await a.openNew({url:e,EL:t,widgetOptions:o}),this._modalFrame}async closeAuthBrowser(){this._modalWindow&&this._modalWindow.close()}async closeModal(){this._modalFrame&&this._modalFrame.close()}}c.WepinModal=f,c.Widget=n,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
