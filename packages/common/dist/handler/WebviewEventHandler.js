import{SafeEventEmitter as e}from"../utils/SafeEventEmitter";import{isWebviewRequestMessage as t,isWebviewResponseMessage as n}from"./WebviewMessage";export var WebviewEventHandler=function(){var r;function a(){var t,n;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,a),t="eventEmitter",n=new e,t in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n}return r=[{key:"getEventListenerFunction",value:function(e){var t=this;return function(n){(!e||e())&&Object.prototype.hasOwnProperty.call(n.data,"header")&&Object.prototype.hasOwnProperty.call(n.data,"body")&&t.handleMessage(n.data)}}},{key:"addRequestHandler",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n){this.eventEmitter.once("request"+e,t);return}this.eventEmitter.addListener("request"+e,t)}},{key:"removeRequestHandler",value:function(e,t){this.eventEmitter.removeListener("request"+e,t)}},{key:"addResponseHandler",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n){this.eventEmitter.once("response"+e,t);return}this.eventEmitter.addListener("response"+e,t)}},{key:"removeResponseHandler",value:function(e,t){this.eventEmitter.removeListener("response"+e,t)}},{key:"makeWepinResponseMessage",value:function(e,t,n){return{header:{response_from:"web",response_to:"wepin_widget",id:e.header.id},body:{command:e.body.command,state:t,data:n}}}},{key:"handleMessage",value:function(e){t(e)?this.eventEmitter.emit("request"+e.body.command,e):n(e)?this.eventEmitter.emit("response"+e.body.command,e):console.error("Failed to handle message:",e)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(a.prototype,r),a}();