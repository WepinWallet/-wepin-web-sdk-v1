import{ethErrors as r}from"eth-rpc-errors";import{signTransactionParameterChecker as e}from"../utils/paramChecker.js";import{requestFactory as t}from"../utils/requestFactory.js";import{getSelectedAddress as n}from"../utils/selectedAddress.js";import{getAddress as a}from"../utils/utils.js";export var signTransaction=function(o){var i=o.wepinProvider,s=o.network;return function(o,p,u,c){if(!i._isInitialized){c(r.provider.unauthorized());return}var m=!1;e(Array.isArray(o.params)?o.params[0]:o.params)||(c(r.rpc.invalidParams()),m=!0);var f=o.params[0].from;n(i.wepinStorage,i.wepinAppId,s).then(function(e){if((null==e?void 0:e.address)!==a(s,f)){c(r.provider.unauthorized());return}if(!m){var n=function(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.forEach(function(e){var n;n=t[e],e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n})}return r}({account:{address:o.params[0].from,network:s}},o.params[0]);t({wepinProvider:i,network:s,req:o,res:p,next:u,end:c,command:"sign_transaction",parameter:n})}})}};