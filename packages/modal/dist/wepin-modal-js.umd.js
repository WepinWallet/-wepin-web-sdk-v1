(function(r,c){typeof exports=="object"&&typeof module!="undefined"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(r=typeof globalThis!="undefined"?globalThis:r||self,c(r["@wepin/modal-js"]={}))})(this,function(r){"use strict";var y=(r,c,m)=>new Promise((f,w)=>{var n=p=>{try{l(m.next(p))}catch(v){w(v)}},a=p=>{try{l(m.throw(p))}catch(v){w(v)}},l=p=>p.done?f(p.value):Promise.resolve(p.value).then(n,a);l((m=m.apply(r,c)).next())});const u=class u{static closeOverlay(e){const t=document.querySelector(`#${e}`);t&&t.parentNode&&t.parentNode.removeChild(t)}static openOverlay(e){const t=document.createElement("div");t.id=e,t.classList.add(this.CONST.overlayClassName),t.style.zIndex="2147483647",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.textAlign="center",t.style.position="fixed",t.style.left="0px",t.style.right="0px",t.style.top="0px",t.style.bottom="0px",t.style.left="0px",t.style.background="rgba(0,0,0,0.6)",t.style.color="white",t.style.border="2px solid #f1f1f1";const o=document.getElementsByClassName(this.CONST.overlayClassName);for(let d=0;d<o.length;d++){const i=o.item(d);i&&i.remove()}document.body.appendChild(t)}};u.CONST={overlayClassName:"wepin-widget__overlay"};let c=u;const m=s=>{const e=(s==null?void 0:s.width)||375,t=(s==null?void 0:s.height)||604,o=s!=null&&s.sLeft?s==null?void 0:s.sLeft:window.screenLeft?window.screenLeft:window.screenX?window.screenX:0,d=s!=null&&s.sTop?s==null?void 0:s.sTop:window.screenTop?window.screenTop:window.screenY?window.screenY:0,i=screen.width/2-e/2+o,W=screen.height/2-t/2+d;return`width=${e}, height=${t}, left=${i}, top=${W}scrollbars=yes, resizable=1, menubar=no, toolbar=no`},f=s=>{const e=document.createElement("iframe");return e.classList.add("wepin-sdk-widget-iframe"),e.setAttribute("frameborder","0"),e.setAttribute("marginwidth","0"),e.setAttribute("marginheight","0"),e.style.width="100%",s&&(s!=null&&s.isHide)?e.style.height="0":e.style.height="100%",e.style.maxHeight="100%",e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.zIndex="408888000000",e.title="wepin sdk webview",e.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; camera; clipboard-read",e.allowFullscreen=!0,e},w=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)}),h=class h extends c{constructor(e,t,o,d,i){super(),this.isWidgetReady=!1,this.url=e,this.id=`id-${w()}`,this.isHide=i,i||h.openOverlay(this.id),h._webview[this.id]=t,this.type=o,this.EL=d,window.addEventListener("message",this.EL),this._open=!0}get isOpen(){return this._open}static getWebview(e){return h._webview[e]}static clearWebview(e){delete h._webview[e]}static clearAllWebview(){this._webview={}}close(){this.isHide||h.closeOverlay(this.id),window.removeEventListener("message",this.EL),this._open=!1,this.isWidgetReady=!1,this._closeWebview()}response(e){try{this._post(e)}catch(t){console.error("Can not response message to the webview",t)}}request(e){try{this._post(e)}catch(t){console.error("Can not send message to the webview",t)}}};h._webview={};let n=h;class a extends n{constructor({url:e,frame:t,EL:o,isHide:d}){super(e,t,"Frame",o,d),t.src=e,t.id=this.id;const i=document.querySelector("body");a.scrollPosition=window.pageYOffset,i.style.overflow="hidden",i.style.position="fixed",i.style.top=`-${a.scrollPosition}px`,i.style.width="100%",document.body.appendChild(t)}static openNew(d){return y(this,arguments,function*({url:e,EL:t,widgetOptions:o}){const i=f({isHide:o==null?void 0:o.isHide});return new a({url:e,frame:i,EL:t,isHide:o==null?void 0:o.isHide})})}expand(){const e=n.getWebview(this.id);e.style.height="100%",e.style.borderRadius="0"}shrink(){const e=n.getWebview(this.id);e.style.height="604px",e.style.borderRadius="12px 12px 0 0 "}_closeWebview(){const e=setTimeout(()=>{const t=n.getWebview(this.id),o=document.querySelector("body");o.style.removeProperty("overflow"),o.style.removeProperty("position"),o.style.removeProperty("top"),o.style.removeProperty("width"),window.scrollTo(0,a.scrollPosition),t&&document.body.removeChild(t),n.clearWebview(this.id),clearTimeout(e)},500)}_post(e){n.getWebview(this.id).contentWindow.postMessage(e,this.url)}}class l extends n{constructor({url:e,webview:t,EL:o}){super(e,t,"Window",o,!1)}static openNew(d){return y(this,arguments,function*({url:e,EL:t,widgetFeatures:o}){const i=m(o),x=window.open(e,"Wepin_Widget",i),b=new l({url:e,webview:x,EL:t});if(!x)throw b.close(),new Error("popup window blocked");return this.timer=setInterval(()=>{try{x&&x.closed&&(clearInterval(this.timer),b.close())}catch(g){clearInterval(this.timer),b.close()}},200),b})}expand(){}shrink(){}_closeWebview(){l.timer&&(clearInterval(l.timer),l.timer=void 0);const e=n.getWebview(this.id);e&&e.close(),n.clearWebview(this.id)}_post(e){n.getWebview(this.id).postMessage(e,this.url)}}const T={name:"@wepin/modal-js",version:"0.0.2",description:"wepin widget modal",author:"IoTrust, Co., Ltd.",license:"MIT",main:"./dist/wepin-modal-js.mjs",jsdelivr:"dist/wepin-modal-js.umd.js",types:"./dist/src/index.d.ts",files:["dist"],scripts:{build:"vite build --mode production",dev:"vite build --mode development",watch:"vite build --watch",lint:"eslint . --ext .vue,.js,.jsx,.cjs,.mjs,.ts,.tsx,.cts,.mts --fix --ignore-path .gitignore"},keywords:["wepin","wepinwallet","wallet","wepin-modal"]};class j{constructor(){this.platformType="web",this._modalWindow=null,this._modalFrame=null,console.log(`WepinModal v${T.version}`),this.domain=window.location.origin}openAuthBrowser(e,t){return y(this,null,function*(){return this._modalWindow=yield l.openNew({url:e,EL:t}),this._modalWindow})}openModal(e,t,o){return y(this,null,function*(){return this._modalFrame=yield a.openNew({url:e,EL:t,widgetOptions:o}),this._modalFrame})}closeAuthBrowser(){return y(this,null,function*(){this._modalWindow&&this._modalWindow.close()})}closeModal(){return y(this,null,function*(){this._modalFrame&&this._modalFrame.close()})}}r.WepinModal=j,r.Widget=n,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
