"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(e,r){for(var i in r)Object.defineProperty(e,i,{enumerable:!0,get:r[i]})}(exports,{checkAndVerifyEmail:function(){return o},signUpEmail:function(){return s}});var e,r,i=require("@wepin/fetch-js");function t(e,r,i,t,n,a,o){try{var s=e[a](o),l=s.value}catch(e){i(e);return}s.done?r(l):Promise.resolve(l).then(t,n)}function n(e){return function(){var r=this,i=arguments;return new Promise(function(n,a){var o=e.apply(r,i);function s(e){t(o,n,a,s,l,"next",e)}function l(e){t(o,n,a,s,l,"throw",e)}s(void 0)})}}function a(e,r){var i,t,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw TypeError("Generator is already executing.");for(;o;)try{if(i=1,t&&(n=2&a[0]?t.return:a[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,a[1])).done)return n;switch(t=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,t=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=r.call(e,o)}catch(e){a=[6,e],t=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var o=(e=n(function(e){var r,t,n,o,s,l,u,c,f,p,h,w,d;return a(this,function(a){switch(a.label){case 0:return r=e.isRequireVerified,t=e.email,n=e.locale,o=e.wepinFetch,s=e.wepinUrl,l=e.openWepinWallet,[4,o.wepinApi.user.checkEmailExist({email:t})];case 1:if(u=a.sent(),(0,i.isErrorResponse)(u))throw Error("failed check email exist");if(c=u.isEmailExist,f=u.isEmailverified,p=u.providerIds,c&&f&&p.includes("password"))throw Error("auth/existed-email");return[4,o.wepinApi.user.verify({type:"create",email:t,localeId:"ko"===n?1:"ja"===n?3:2})];case 2:if(h=a.sent(),(0,i.isErrorResponse)(h))throw w=h.statusCode,d="fail/send-email",400===w&&(d="invalid/email-domain"),Error(d);if(r)throw l&&(s.pathname="/signup/email/authentication",s.searchParams.set("email",t),s.searchParams.set("type","widget"),s.searchParams.set("language",n),window.open(s.toString(),"_blank")),Error("auth/email-verified");return[2,{oobReset:h.oobReset,oobVerify:h.oobVerify}]}})}),function(r){return e.apply(this,arguments)}),s=(r=n(function(e){var r,t,n,o,s,l,u;return a(this,function(a){switch(a.label){case 0:r=e.oobReset,t=e.oobVerify,n=e.email,o=e.password,s=e.wepinFetch,a.label=1;case 1:return a.trys.push([1,4,,5]),[4,s.wepinFirebaseApi.resetPassword(r,o,!1)];case 2:if(l=a.sent(),(0,i.isFirebaseErrorResponse)(l)||l.email.toLowerCase()!==n)throw Error("fail/reset-password");return[4,s.wepinFirebaseApi.verifyEmail(t)];case 3:if(u=a.sent(),(0,i.isFirebaseErrorResponse)(u)||u.email.toLowerCase()!==n)throw Error("fail/email-verified");return[3,5];case 4:throw Error("signUpEmail error"+a.sent().message);case 5:return[2]}})}),function(e){return r.apply(this,arguments)});