import{Platform as e}from"../types/Platform";import{proxyToObject as a}from"../utils/utils";export var WebviewRequestHandler=function(t,o,i){var d,n={header:{response_from:"web",response_to:"wepin_widget",id:t.header.id}},p=i.appKey;switch(p="local_ak_dev_"===i.appKey.slice(0,13)?i.appKey.slice(6):i.appKey,t.body.command){case"ready_to_widget":o.wepinStorage.getAllLocalStorage(i.appId).then(function(a){var t,d=Object.assign({},o.wepinAppAttributes);n.body={command:"ready_to_widget",state:"SUCCESS",data:{appKey:p,appId:i.appId,domain:o.wepinDomain,platform:e[o.type],attributes:d,type:"".concat(o.type,"-provider"),version:o.version.includes("-alpha")?o.version.substring(0,o.version.indexOf("-")):o.version,localDate:null!=a?a:{}}},(null===(t=o.wepinWidget)||void 0===t?void 0:t.isOpen)&&o.wepinWidget.response(n)});break;case"close_wepin_widget":o.wepinWidget.close();break;case"dequeue_request":if(o.queue[0]){var r=a(o.queue[0]);n.body={command:t.body.command,state:"SUCCESS",data:r}}else n.body={command:t.body.command,state:"ERROR",data:null};(null===(d=o.wepinWidget)||void 0===d?void 0:d.isOpen)&&o.wepinWidget.response(n);break;case"set_local_storage":o.wepinStorage.setAllLocalStorage(i.appId,t.body.parameter.data).then(function(){var e;n.body={command:"set_local_storage",state:"SUCCESS",data:""},(null===(e=o.wepinWidget)||void 0===e?void 0:e.isOpen)&&o.wepinWidget.response(n)});break;default:throw Error("Command ".concat(t.body.command," is not supported."))}};