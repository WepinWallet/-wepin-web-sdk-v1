function e(e,t,r,a,n,o,i){try{var s=e[o](i),p=s.value}catch(e){r(e);return}s.done?t(p):Promise.resolve(p).then(a,n)}import{Platform as t}from"../types/Platform";import{proxyToObject as r}from"../utils/proxyToObject";export var WebviewRequestHandler=function(a,n,o){var i,s,p,d,l={header:{response_from:"web",response_to:"wepin_widget",id:a.header.id}},u=o.appKey;switch(u="local_ak_dev_"===o.appKey.slice(0,13)?o.appKey.slice(6):o.appKey,a.body.command){case"ready_to_widget":n.wepinStorage.getAllLocalStorage(o.appId).then(function(e){var r,a,i,s=Object.assign({},n.wepinAppAttributes),p=(null===(r=n.wepinAppAttributes.loginProviders)||void 0===r?void 0:r.length)||(null===(a=n.wepinAppAttributes.loginProviders)||void 0===a?void 0:a.length)===0?Array.from(n.wepinAppAttributes.loginProviders):void 0;s.loginProviders=p,l.body={command:"ready_to_widget",state:"SUCCESS",data:{appKey:u,appId:o.appId,domain:n.wepinDomain,platform:t[n.type],attributes:s,version:n.version.includes("-alpha")?n.version.substring(0,n.version.indexOf("-")):n.version,type:"".concat(n.type,"-sdk"),localDate:null!=e?e:{}}},(null===(i=n.wepinWidget)||void 0===i?void 0:i.isOpen)&&n.wepinWidget.response(l)});break;case"close_wepin_widget":n.wepinWidget&&(n.wepinWidget.close(),n.wepinWidget=void 0),n.wepinStorage.getAllLocalStorage(o.appId).then(function(e){var t,r=e.user_info;if(r){var a=e.user_status;r.userStatus=a,n.setUserInfo(r,!0)}else n.setUserInfo({status:"fail"},!0);n.specifiedEmail=void 0,(null===(t=n.wepinWidget)||void 0===t?void 0:t.isOpen)&&n.wepinWidget.response(l)});break;case"set_local_storage":n.wepinStorage.setAllLocalStorage(o.appId,a.body.parameter.data).then((i=function(){var e,t,r;return function(e,t){var r,a,n,o,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],a=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,function(o){switch(o.label){case 0:if(a.body.parameter.data&&a.body.parameter.data.user_info&&(t=a.body.parameter.data.user_info,r=a.body.parameter.data.user_status,t.userStatus=r,n.setUserInfo(t,!0)),!(a.body.parameter.data&&a.body.parameter.data["wepin:connectUser"]))return[3,2];return[4,n.setToken(a.body.parameter.data["wepin:connectUser"])];case 1:o.sent(),o.label=2;case 2:return l.body={command:"set_local_storage",state:"SUCCESS",data:""},(null===(e=n.wepinWidget)||void 0===e?void 0:e.isOpen)&&n.wepinWidget.response(l),[2]}})},function(){var t=this,r=arguments;return new Promise(function(a,n){var o=i.apply(t,r);function s(t){e(o,a,n,s,p,"next",t)}function p(t){e(o,a,n,s,p,"throw",t)}s(void 0)})}));break;case"set_user_email":l.body={command:"set_user_email",state:"SUCCESS",data:{email:n.specifiedEmail}},(null===(s=n.wepinWidget)||void 0===s?void 0:s.isOpen)&&n.wepinWidget.response(l);break;case"get_sdk_request":l.body={command:"get_sdk_request",state:"SUCCESS",data:null!==(d=r(n.getSDKRequest()))&&void 0!==d?d:"No request"},(null===(p=n.wepinWidget)||void 0===p?void 0:p.isOpen)&&n.wepinWidget.response(l);break;default:throw Error("Command ".concat(a.body.command," is not supported."))}};