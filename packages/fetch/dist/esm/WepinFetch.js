function e(e,n,t,i,r,o,a){try{var s=e[o](a),u=s.value}catch(e){t(e);return}s.done?n(u):Promise.resolve(u).then(i,r)}function n(n){return function(){var t=this,i=arguments;return new Promise(function(r,o){var a=n.apply(t,i);function s(n){e(a,r,o,s,u,"next",n)}function u(n){e(a,r,o,s,u,"throw",n)}s(void 0)})}}function t(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(t)throw TypeError("Generator is already executing.");for(;a;)try{if(t=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=n.call(e,a)}catch(e){o=[6,e],i=0}finally{t=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}import{getModeByAppKey as o,getUrlsByMode as a}from"@wepin/common";import s from"@wepin/fetch-js/package.json";import u from"@wepin/storage-js";import c from"./api/firebaseAuth/FirebaseAuthAPI.js";import p from"./api/wepin/WepinSdkAPI.js";export var WepinFetch=/*#__PURE__*/function(){var e,l;function f(e){var n=e.appId,t=e.appKey,r=e.domain,o=e.sdk,a=e.storage;!function(e,n){if(!(e instanceof n))throw TypeError("Cannot call a class as a function")}(this,f),i(this,"version",void 0),i(this,"appId",void 0),i(this,"sdk",void 0),i(this,"_appKey",void 0),i(this,"_isInitialized",void 0),i(this,"_token",void 0),i(this,"_domain",void 0),i(this,"_wepinStorage",void 0),i(this,"wepinApi",void 0),i(this,"wepinFirebaseApi",void 0),this.version=s.version,this.appId=n,this._appKey=t,this._domain=r,this._token=void 0,this.sdk=o,this._wepinStorage=null!=a?a:new u}return e=[{key:"init",value:function(){var e=this;return n(function(){var n;return r(this,function(t){switch(t.label){case 0:return[4,f.getFirebaseConfig(e._appKey,e.sdk.type,e.sdk.version)];case 1:return n=t.sent(),e.wepinFirebaseApi=new c(n),e.wepinApi=new p(a(o(e._appKey)).sdkBackend,{appId:e.appId,appKey:e._appKey,domain:e._domain,sdk:e.sdk,wepinFetch:e}),e._isInitialized=!0,[2]}})})()}},{key:"isInitialized",value:function(){return this._isInitialized}},{key:"Token",value:function(){var e=this;return n(function(){return r(this,function(n){switch(n.label){case 0:return[4,e._wepinStorage.getLocalStorage(e.appId,"wepin:connectUser")];case 1:return e._token=n.sent(),[2,e._token]}})})()}},{key:"setToken",value:function(e){var t=this;return n(function(){return r(this,function(n){switch(n.label){case 0:if(t._token=e,!e)return[3,2];return[4,t._wepinStorage.setLocalStorage(t.appId,"wepin:connectUser",e)];case 1:return n.sent(),[3,4];case 2:return[4,t._wepinStorage.clearLocalStorage(t.appId,"wepin:connectUser")];case 3:n.sent(),n.label=4;case 4:return[2]}})})()}}],l=[{key:"getFirebaseConfig",value:function(e,t,i){return n(function(){var n;return r(this,function(r){switch(r.label){case 0:return n=a(o(e)).sdkBackend,[4,fetch("".concat(n,"/user/firebase-config"),{method:"GET",headers:{"X-API-KEY":e,"X-SDK-TYPE":t,"X-SDK-VERSION":i,"Content-Type":"application/json"}})];case 1:return[4,r.sent().text()];case 2:return[2,JSON.parse(atob(r.sent()))]}})})()}}],e&&t(f.prototype,e),l&&t(f,l),f}();