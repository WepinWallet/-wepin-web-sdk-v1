"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(e,n){for(var r in n)Object.defineProperty(e,r,{enumerable:!0,get:n[r]})}(exports,{WepinSolanaWalletAdapter:function(){return d},WepinWalletName:function(){return f}});var e=require("@solana/wallet-adapter-base"),n=require("@solana/web3.js"),r=require("@wepin/provider-js"),t=require("./utils/util.js");function i(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=Array(n);r<n;r++)t[r]=e[r];return t}function o(e,n,r,t,i,o,a){try{var u=e[o](a),c=u.value}catch(e){r(e);return}u.done?n(c):Promise.resolve(c).then(t,i)}function a(e){return function(){var n=this,r=arguments;return new Promise(function(t,i){var a=e.apply(n,r);function u(e){o(a,t,i,u,c,"next",e)}function c(e){o(a,t,i,u,c,"throw",e)}u(void 0)})}}function u(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,n){return(l=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function s(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(s=function(){return!!e})()}function M(e,n){var r,t,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,t&&(i=2&o[0]?t.return:o[0]?t.throw||((i=t.return)&&i.call(t),0):t.next)&&!(i=i.call(t,o[1])).done)return i;switch(t=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,t=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=n.call(e,a)}catch(e){o=[6,e],t=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}var f="Wepin",d=/*#__PURE__*/function(o){"use strict";var d;function p(n){var r,t,i,o,a;return!function(e,n){if(!(e instanceof n))throw TypeError("Cannot call a class as a function")}(this,p),i=c(i=p),u(r=(a=s()?Reflect.construct(i,[],c(this).constructor):i.apply(this,o))&&("object"==(a&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a)||"function"==typeof a)?a:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this),"name",f),u(r,"url","https://app.wepin.io"),u(r,"icon","data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyLjE1IDIuNjkzODVDNy45MjQ5NiAyLjY5Mzg1IDQuNSA2LjExODgxIDQuNSAxMC4zNDM4QzQuNSAxMS42OTE2IDQuODU3MjYgMTIuNTM0NSA1LjQ1NDExIDE0LjA2MTlMNy44MzkzOSAxOS42NzUzQzguMTkwMjMgMjAuNjU5NCA5LjEyNTA4IDIxLjM2MzIgMTAuMjI4OSAyMS4zNjMyQzExLjI2MDEgMjEuMzYzMiAxMi4xNDc5IDIwLjc0NzEgMTIuNTQzNiAxOS44NjE0TDEzLjQ3MjEgMTcuODc2MkMxNy4wNjYgMTcuMjQ5NCAxOS44IDE0LjExNzUgMTkuOCAxMC4zNDM4QzE5Ljc5NzkgNi4xMTg4MSAxNi4zNzI5IDIuNjkzODUgMTIuMTUgMi42OTM4NVpNMTIuMTUgMTUuMzUxOUMxMi4wMDQ1IDE1LjM1MTkgMTEuODYzMyAxNS4zNDMzIDExLjcyMjEgMTUuMzMyNkwxMS43MDcyIDE1LjM2NDdMMTAuMjE4MiAxOC41NDE1TDEwLjIxNCAxOC41MzI5TDcuNzcwOTMgMTIuNzgwNUM3LjMyMzgzIDExLjY4NTIgNy4xNDE5OSAxMS4yMjc0IDcuMTQxOTkgMTAuMzQxN0M3LjE0MTk5IDcuNTc1NjQgOS4zODM5MyA1LjMzMzcgMTIuMTUgNS4zMzM3QzE0LjkxNjEgNS4zMzM3IDE3LjE1OCA3LjU3NTY0IDE3LjE1OCAxMC4zNDE3QzE3LjE1OCAxMy4xMDc4IDE0LjkxNjEgMTUuMzQ5NyAxMi4xNSAxNS4zNDk3VjE1LjM1MTlaIiBmaWxsPSIjNjQ0MEREIi8+CjxwYXRoIGQ9Ik0xMi4xNTA0IDEyLjI5NjlDMTMuMjI5MSAxMi4yOTY5IDE0LjEwMzYgMTEuNDIyNSAxNC4xMDM2IDEwLjM0MzhDMTQuMTAzNiA5LjI2NTA4IDEzLjIyOTEgOC4zOTA2MiAxMi4xNTA0IDguMzkwNjJDMTEuMDcxNyA4LjM5MDYyIDEwLjE5NzMgOS4yNjUwOCAxMC4xOTczIDEwLjM0MzhDMTAuMTk3MyAxMS40MjI1IDExLjA3MTcgMTIuMjk2OSAxMi4xNTA0IDEyLjI5NjlaIiBmaWxsPSIjNjQ0MEREIi8+Cjwvc3ZnPgo="),u(r,"supportedTransactionVersions",new Set(["legacy",0])),u(r,"_wepinProvider",void 0),u(r,"_provider",void 0),u(r,"_readyState","undefined"==typeof window||"undefined"==typeof document?e.WalletReadyState.Unsupported:e.WalletReadyState.Loadable),u(r,"_publicKey",void 0),u(r,"_connecting",void 0),u(r,"_network",void 0),u(r,"_config",void 0),r._connecting=!1,r._publicKey=null,r._wepinProvider=null,r._network=null!==(t=n.network)&&void 0!==t?t:"solana",r._config=n,r._provider=null,r}return!function(e,n){if("function"!=typeof n&&null!==n)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&l(e,n)}(p,o),d=[{key:"publicKey",get:function(){return this._publicKey}},{key:"connecting",get:function(){return this._connecting}},{key:"readyState",get:function(){return this._readyState}},{key:"signMessage",value:function(n){var r=this;return a(function(){var t,i;return M(this,function(o){switch(o.label){case 0:if(!r._provider)throw new e.WalletNotConnectedError;return[4,null===(t=r._provider)||void 0===t?void 0:t.request({method:"signMessage",params:[r.publicKey.toBase58(),new TextDecoder().decode(n)]})];case 1:if(!(i=o.sent()))throw Error("Sign message failed");return[2,new Uint8Array(i.match(/.{1,2}/g).map(function(e){return parseInt(e,16)}))]}})})()}},{key:"signTransaction",value:function(n){var r=this;return a(function(){var i,o;return M(this,function(a){switch(a.label){case 0:if(!r._provider)throw new e.WalletNotConnectedError;return i=(0,e.isVersionedTransaction)(n)?(0,t.uintToHexString)(n.message.serialize()):(0,t.uintToHexString)(n.serializeMessage()),[4,r._provider.request({method:"signTransaction",params:{transaction:i}})];case 1:if(!(o=a.sent()))throw Error("Sign transaction failed");return[2,o]}})})()}},{key:"sendTransaction",value:function(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=this;return a(function(){var r,a,c,l,s;return M(this,function(M){var f,d;switch(M.label){case 0:if(M.trys.push([0,5,,6]),!u._provider)throw new e.WalletNotConnectedError;M.label=1;case 1:return(M.trys.push([1,3,,4]),r=o.signers,(0,e.isVersionedTransaction)(n))?((null==r?void 0:r.length)&&n.sign(r),a=(0,t.uintToHexString)(n.message.serialize())):((null==r?void 0:r.length)&&(c=n).partialSign.apply(c,function(e){if(Array.isArray(e))return i(e)}(r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||function(e,n){if(e){if("string"==typeof e)return i(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,void 0)}}(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=(0,t.uintToHexString)(n.serializeMessage())),[4,u._provider.request({method:"signAndSendTransaction",params:{transaction:a}})];case 2:return[2,M.sent().signature];case 3:if(f=l=M.sent(),null!=(d=e.WalletError)&&"undefined"!=typeof Symbol&&d[Symbol.hasInstance]?!!d[Symbol.hasInstance](f):f instanceof d)throw l;throw new e.WalletSendTransactionError(null==l?void 0:l.message,l);case 4:return[3,6];case 5:throw s=M.sent(),u.emit("error",s),s;case 6:return[2]}})})()}},{key:"connect",value:function(){var t=this;return a(function(){var i,o,a,u,c,l,s,f,d,p,y,g,v;return M(this,function(M){switch(M.label){case 0:if(t.connecting||t.connected)return[2];if(t._connecting=!0,t._wepinProvider||(t._wepinProvider=new r.WepinProvider({appId:t._config.appId,appKey:t._config.appKey})),null===(i=t._wepinProvider)||void 0===i?void 0:i.isInitialized())return[3,4];M.label=1;case 1:return M.trys.push([1,3,,4]),[4,null===(u=t._wepinProvider)||void 0===u?void 0:u.init({defaultCurrency:null!==(c=null===(o=t._config.attributes)||void 0===o?void 0:o.defaultCurrency)&&void 0!==c?c:"USD",defaultLanguage:null!==(l=null===(a=t._config.attributes)||void 0===a?void 0:a.defaultLanguage)&&void 0!==l?l:"en"})];case 2:return M.sent(),[3,4];case 3:throw s=M.sent(),new e.WalletConnectionError(null==s?void 0:s.message,s);case 4:if(t._provider)return[3,8];M.label=5;case 5:return M.trys.push([5,7,,8]),[4,null===(f=t._wepinProvider)||void 0===f?void 0:f.getProvider(t._network)];case 6:return t._provider=null!==(d=M.sent())&&void 0!==d?d:null,[3,8];case 7:throw p=M.sent(),new e.WalletConnectionError(null==p?void 0:p.message,p);case 8:return M.trys.push([8,10,11,12]),[4,t._provider.request({method:"connect",params:[]})];case 9:return y=M.sent(),g=new n.PublicKey(y.publicKey),t._publicKey=g,t.emit("connect",g),[3,12];case 10:throw v=M.sent(),t.emit("error",v),v;case 11:return t._connecting=!1,[7];case 12:return[2]}})})()}},{key:"disconnect",value:function(){var n=this;return a(function(){return M(this,function(r){if(!n._provider)return[2];n._publicKey=null;try{n._wepinProvider.finalize()}catch(r){n.emit("error",new e.WalletDisconnectedError)}return n.emit("disconnect"),[2]})})()}}],function(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}(p.prototype,d),p}(e.BaseMessageSignerWalletAdapter);