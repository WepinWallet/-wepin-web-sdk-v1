import{ethErrors as r}from"eth-rpc-errors";import{kaiaBaseTxType as e,kaiaFeeDelegatedTxType as t}from"../const/kaiaTxType.js";import{signTransactionParameterChecker as n}from"../utils/paramChecker.js";import{requestFactory as o}from"../utils/requestFactory.js";import{getSelectedAddress as i}from"../utils/selectedAddress.js";import{getAddress as a}from"../utils/utils.js";export var signTransaction=function(s){var p=s.wepinProvider,u=s.network;return function(s,c,m,f){if(!p._isInitialized){f(r.provider.unauthorized());return}var d=!1,l=Array.isArray(s.params)?s.params[0]:s.params;if(n(l)||(f(r.rpc.invalidParams()),d=!0),u.startsWith("klaytn")&&l.typeInt&&!e.includes(l.typeInt)&&!t.includes(l.typeInt)){f(r.rpc.methodNotSupported());return}var y=s.params[0].from;i(p.wepinStorage,p.wepinAppId,u).then(function(e){if((null==e?void 0:e.address)!==a(u,y)){f(r.provider.unauthorized());return}if(!d){var t=function(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.forEach(function(e){var n;n=t[e],e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n})}return r}({account:{address:s.params[0].from,network:u}},s.params[0]);o({wepinProvider:p,network:u,req:s,res:c,next:m,end:f,command:"sign_transaction",parameter:t})}})}};